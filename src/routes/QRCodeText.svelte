<script lang="ts">
	import { createTabs, melt } from '@melt-ui/svelte';
	import QRCode from 'qrcode';

	let actualText = '';

	const isTooLong = (text: string) => {
		try {
			QRCode.create(text);
		} catch (error: unknown) {
			if (error instanceof Error) {
				return error.message === 'The amount of data is too big to be stored in a QR Code';
			}
		}
	};
	$: tooLong = isTooLong(actualText);

	const tabs: { id: string; title: string }[] = [
		{ id: 'url', title: 'URL' },
		{ id: 'text', title: 'Text' },
		{ id: 'wifi', title: 'Wifi' },
		{ id: 'vcard', title: 'vCard' },
		{ id: 'email', title: 'Email' },
		{ id: 'sms', title: 'SMS' },
	];

	const {
		elements: { root, list, content, trigger },
		states: { value },
	} = createTabs({
		defaultValue: 'url',
	});
</script>

<div
	use:melt={$root}
	class="flex max-w-[25rem] flex-col overflow-hidden rounded-md shadow-lg
  data-[orientation=vertical]:flex-row"
>
	<div
		use:melt={$list}
		class="flex shrink-0 overflow-x-auto border-b border-blue-100 bg-white
    data-[orientation=vertical]:flex-col data-[orientation=vertical]:border-r"
		aria-label="Manage your account"
	>
		<button use:melt={$trigger('tab1')} class="trigger">Account</button>
		<button use:melt={$trigger('tab2')} class="trigger">Password</button>
		<button use:melt={$trigger('tab3')} class="trigger">Settings</button>
	</div>
	<div use:melt={$content('tab1')} class="grow bg-white p-5">
		<p class="mb-5 leading-normal text-blue-950">
			Make changes to your account here. Click save when you're done.
		</p>
		<fieldset class="mb-4 flex w-full flex-col justify-start">
			<label class="mb-2.5 block text-sm leading-none text-blue-950" for="name"> Name </label>
			<input id="name" value="Thomas G. Lopes" />
		</fieldset>

		<div class="mt-5 flex justify-end">
			<button class="save">Save changes</button>
		</div>
	</div>
	<div use:melt={$content('tab2')} class="grow bg-white p-5">
		<p class="mb-5 leading-normal text-blue-950">
			Change your password here. Click save when you're done.
		</p>
		<fieldset class="mb-4 flex w-full flex-col justify-start">
			<label class="mb-2.5 block text-sm leading-none text-blue-950" for="new">
				New password
			</label>
			<input id="new" type="password" />
		</fieldset>
		<div class="mt-5 flex justify-end">
			<button class="save">Save changes</button>
		</div>
	</div>
	<div use:melt={$content('tab3')} class="grow bg-white p-5">
		<p class="mb-5 leading-normal text-blue-950">
			Change your settings here. Click save when you're done.
		</p>

		<fieldset class="mb-4 flex w-full flex-col justify-start">
			<label class="mb-2.5 block text-sm leading-none text-blue-950" for="new"> New email </label>
			<input id="new" type="password" />
		</fieldset>
		<div class="mt-5 flex justify-end">
			<button class="save">Save changes</button>
		</div>
	</div>
</div>

<style lang="postcss">
	.trigger {
		display: flex;
		height: theme(spacing.11);
		flex: 1;
		cursor: default;
		user-select: none;
		align-items: center;
		justify-content: center;
		border-radius: 0;
		background-color: theme(colors.white);
		padding-inline: theme(spacing.2);
		line-height: 1;
		color: theme(colors.blue.900);

		&:focus {
			position: relative;
		}

		&[data-orientation='vertical'] {
			@apply w-full flex-grow-0 rounded-none border-b border-r-2;
			@apply border-transparent border-b-blue-100 py-4 last:border-b-0;
		}

		&[data-state='active'] {
			@apply text-blue-700 focus:relative;
		}

		&[data-state='active'][data-orientation='horizontal'] {
			@apply shadow-[inset_0_-1px_0_0,0_1px_0_0] shadow-current focus:relative;
		}

		&[data-state='active'][data-orientation='vertical'] {
			@apply border-r-blue-500;
		}
	}

	input {
		height: theme(spacing.8);
		flex-shrink: 0;
		flex-grow: 1;
		border-radius: theme(borderRadius.md);
		border: 1px solid theme(colors.neutral.200);
		padding-inline: theme(spacing[2.5]);
		line-height: 1;
		color: theme(colors.blue.900);

		&:focus {
			border-color: theme(colors.blue.400);
		}
	}

	.save {
		display: inline-flex;
		height: theme(spacing.8);
		cursor: default;
		align-items: center;
		justify-content: center;
		border-radius: theme(borderRadius.md);
		background-color: theme(colors.green.100);
		padding-inline: theme(spacing.4);
		line-height: 1;
		font-weight: theme(fontWeight.semibold);
		color: theme(colors.green.900);

		&:hover {
			background-color: theme(colors.green.200);
		}

		&:focus {
			@apply !ring-green-600;
		}
	}
</style>
